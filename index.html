<!DOCTYPE html>
<html>

<head>
    <title>Robo puzzle</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id='hiddenImgs'>
        <img id="blackTile" src="images/black_tile.png" />
        <img id="robo" src="images/arrow_right.png" />
        <img id="robo_l" src="images/arrow_left.png" />
        <img id="robo_d" src="images/arrow_down.png" />
        <img id="robo_u" src="images/arrow_up.png" />
        <img id="star" src="images/star.png" />
    </div>
    <div id='controlDiv'>
        <canvas id="board" width="540" height="360"></canvas>
        <p>
            <div id="control">
                <input type="button" name="move" value="Move" onclick="robo.move()" />
                <input type="button" name="left" value="Turn Left" onclick="robo.turnLeft()" />
                <input type="button" name="right" value="Turn Right" onclick="robo.turnRight()" />
            </div>
        </p>
    </div>
    <div id='commandDiv'>
        <div id='commandListDiv'>
            <span style="font-size: 36px">F1</span>
            <span>&nbsp;&nbsp;&nbsp;</span>
            <img src="images/black_tile.png" ondrop="onCommandDrop(event)" ondragover="allowDrop(event)" />
            <img src="images/black_tile.png" />
            <img src="images/black_tile.png" />
            <img src="images/black_tile.png" />
            <img src="images/black_tile.png" />
            <img src="images/black_tile.png" />
            <img src="images/black_tile.png" />
        </div>
        <div style="width: 35%; float: right; padding-right: 100px; position: relative; bottom: 36px">
            <img id="turn_l" src="images/turn_left.png" draggable="true" ondragstart="dragStartHandler(event,this);" class="commandImgTile" />
            <img id="turn_r" src="images/turn_right.png" class="commandImgTile" />
            <img id="f1" src="images/f1.png" class="commandImgTile" />
            <img id="f2" src="images/f2.png" class="commandImgTile" />
        </div>
    </div>
    <script type="text/javascript" src="scripts/data.js"></script>
    <script type="text/javascript" src="scripts/robo.js"></script>
    <script type="text/javascript" src="scripts/boardmanager.js"></script>
    <script type="text/javascript">

    	
    function allowDrop(ev) {
        ev.preventDefault();
    }

    function onCommandDrop(ev) {
        ev.preventDefault();
        var imgUrl = ev.dataTransfer.getData("text");
        ev.target.src = imgUrl;
    }

    function dragStartHandler(ev, img) {
        // TODO: do I really need to handle this?
    }

    var roboImgs = {
        right: document.getElementById("robo"),
        left: document.getElementById("robo_l"),
        down: document.getElementById("robo_d"),
        up: document.getElementById("robo_u")
    };
    var robo = new Robo(startPos = { x: 7, y: 4 });

    var starImg = document.getElementById("star");

    var mainBoard = document.getElementById('board');
    var boardManager = new BoardManager(mainBoard, MATRIX, STARS_LOCATION);

    window.onload = function() {
        boardManager.init();
        boardManager.drawStarList(starImg);
        boardManager.handleRobotMove(robo, roboImgs);
    };
    // refresh every 30 mil sec
    var gameIntervalId = window.setInterval(() => window.requestAnimationFrame(function() {
        boardManager.clearCanvas();
        boardManager.init();
        boardManager.drawStarList(starImg);
        boardManager.handleRobotMove(robo, roboImgs);
    }), 30);

    var checkIntervalId = window.setInterval(() => {
        if (boardManager.gameOver()) {
            window.clearInterval(gameIntervalId);
            window.clearInterval(checkIntervalId);
            alert("Game over ^^");
        }
    }, 1000);
    </script>
</body>

</html>